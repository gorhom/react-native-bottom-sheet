{"version":3,"sources":["BottomSheetModal.tsx"],"names":["INITIAL_STATE","mount","data","undefined","BottomSheetModalComponent","BottomSheetModal","props","ref","name","stackBehavior","DEFAULT_STACK_BEHAVIOR","enableDismissOnClose","DEFAULT_ENABLE_DISMISS_ON_CLOSE","onDismiss","_providedOnDismiss","index","snapPoints","enablePanDownToClose","animateOnMount","containerComponent","ContainerComponent","React","Fragment","onChange","_providedOnChange","children","Content","bottomSheetProps","setState","containerHeight","containerOffset","mountSheet","unmountSheet","willUnmountSheet","removePortal","unmountPortal","bottomSheetRef","currentIndexRef","restoreIndexRef","minimized","forcedDismissed","mounted","current","key","resetVariables","component","method","unmount","_mounted","handleSnapToIndex","args","snapToIndex","handleSnapToPosition","snapToPosition","handleExpand","expand","handleCollapse","collapse","handleClose","close","handleForceClose","forceClose","handlePresent","_data","requestAnimationFrame","handleDismiss","animationConfigs","params","handleMinimize","handleRestore","handlePortalOnUnmount","handlePortalRender","render","handleBottomSheetOnChange","_index","handleBottomSheetOnClose","dismiss","present","minimize","restore","displayName"],"mappings":"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","sourcesContent":["import React, {\n  forwardRef,\n  memo,\n  useCallback,\n  useImperativeHandle,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { Portal, usePortal } from '@gorhom/portal';\nimport BottomSheet from '../bottomSheet';\nimport { useBottomSheetModalInternal } from '../../hooks';\nimport { print } from '../../utilities';\nimport {\n  DEFAULT_STACK_BEHAVIOR,\n  DEFAULT_ENABLE_DISMISS_ON_CLOSE,\n} from './constants';\nimport type { BottomSheetModalMethods, BottomSheetMethods } from '../../types';\nimport type { BottomSheetModalProps } from './types';\nimport { id } from '../../utilities/id';\n\ntype BottomSheetModal = BottomSheetModalMethods;\n\nconst INITIAL_STATE: {\n  mount: boolean;\n  data: any;\n} = {\n  mount: false,\n  data: undefined,\n};\n\nconst BottomSheetModalComponent = forwardRef<\n  BottomSheetModal,\n  BottomSheetModalProps\n>(function BottomSheetModal(props, ref) {\n  const {\n    // modal props\n    name,\n    stackBehavior = DEFAULT_STACK_BEHAVIOR,\n    enableDismissOnClose = DEFAULT_ENABLE_DISMISS_ON_CLOSE,\n    onDismiss: _providedOnDismiss,\n\n    // bottom sheet props\n    index = 0,\n    snapPoints,\n    enablePanDownToClose = true,\n    animateOnMount = true,\n    containerComponent: ContainerComponent = React.Fragment,\n\n    // callbacks\n    onChange: _providedOnChange,\n\n    // components\n    children: Content,\n    ...bottomSheetProps\n  } = props;\n\n  //#region state\n  const [{ mount, data }, setState] = useState(INITIAL_STATE);\n  //#endregion\n\n  //#region hooks\n  const {\n    containerHeight,\n    containerOffset,\n    mountSheet,\n    unmountSheet,\n    willUnmountSheet,\n  } = useBottomSheetModalInternal();\n  const { removePortal: unmountPortal } = usePortal();\n  //#endregion\n\n  //#region refs\n  const bottomSheetRef = useRef<BottomSheet>(null);\n  const currentIndexRef = useRef(!animateOnMount ? index : -1);\n  const restoreIndexRef = useRef(-1);\n  const minimized = useRef(false);\n  const forcedDismissed = useRef(false);\n  const mounted = useRef(false);\n  mounted.current = mount;\n  //#endregion\n\n  //#region variables\n  const key = useMemo(() => name || `bottom-sheet-modal-${id()}`, [name]);\n  //#endregion\n\n  //#region private methods\n  const resetVariables = useCallback(function resetVariables() {\n    print({\n      component: BottomSheetModal.name,\n      method: resetVariables.name,\n    });\n    currentIndexRef.current = -1;\n    restoreIndexRef.current = -1;\n    minimized.current = false;\n    mounted.current = false;\n    forcedDismissed.current = false;\n  }, []);\n  const unmount = useCallback(\n    function unmount() {\n      print({\n        component: BottomSheetModal.name,\n        method: unmount.name,\n      });\n      const _mounted = mounted.current;\n\n      // reset variables\n      resetVariables();\n\n      // unmount sheet and portal\n      unmountSheet(key);\n      unmountPortal(key);\n\n      // unmount the node, if sheet is still mounted\n      if (_mounted) {\n        setState(INITIAL_STATE);\n      }\n\n      // fire `onDismiss` callback\n      if (_providedOnDismiss) {\n        _providedOnDismiss();\n      }\n    },\n    [key, resetVariables, unmountSheet, unmountPortal, _providedOnDismiss]\n  );\n  //#endregion\n\n  //#region bottom sheet methods\n  const handleSnapToIndex = useCallback<BottomSheetMethods['snapToIndex']>(\n    (...args) => {\n      if (minimized.current) {\n        return;\n      }\n      bottomSheetRef.current?.snapToIndex(...args);\n    },\n    []\n  );\n  const handleSnapToPosition = useCallback<\n    BottomSheetMethods['snapToPosition']\n  >((...args) => {\n    if (minimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.snapToPosition(...args);\n  }, []);\n  const handleExpand = useCallback<BottomSheetMethods['expand']>((...args) => {\n    if (minimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.expand(...args);\n  }, []);\n  const handleCollapse = useCallback<BottomSheetMethods['collapse']>(\n    (...args) => {\n      if (minimized.current) {\n        return;\n      }\n      bottomSheetRef.current?.collapse(...args);\n    },\n    []\n  );\n  const handleClose = useCallback<BottomSheetMethods['close']>((...args) => {\n    if (minimized.current) {\n      return;\n    }\n    bottomSheetRef.current?.close(...args);\n  }, []);\n  const handleForceClose = useCallback<BottomSheetMethods['forceClose']>(\n    (...args) => {\n      if (minimized.current) {\n        return;\n      }\n      bottomSheetRef.current?.forceClose(...args);\n    },\n    []\n  );\n  //#endregion\n\n  //#region bottom sheet modal methods\n  const handlePresent = useCallback(\n    function handlePresent(_data?: any) {\n      requestAnimationFrame(() => {\n        setState({\n          mount: true,\n          data: _data,\n        });\n        mountSheet(key, ref, stackBehavior);\n\n        print({\n          component: BottomSheetModal.name,\n          method: handlePresent.name,\n        });\n      });\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [key, stackBehavior, mountSheet]\n  );\n  const handleDismiss = useCallback<BottomSheetModalMethods['dismiss']>(\n    function handleDismiss(animationConfigs) {\n      print({\n        component: BottomSheetModal.name,\n        method: handleDismiss.name,\n        params: {\n          currentIndexRef: currentIndexRef.current,\n          minimized: minimized.current,\n        },\n      });\n      /**\n       * if modal is already been dismiss, we exit the method.\n       */\n      if (currentIndexRef.current === -1 && minimized.current === false) {\n        return;\n      }\n\n      if (\n        minimized.current ||\n        (currentIndexRef.current === -1 && enablePanDownToClose)\n      ) {\n        unmount();\n        return;\n      }\n      willUnmountSheet(key);\n      forcedDismissed.current = true;\n      bottomSheetRef.current?.forceClose(animationConfigs);\n    },\n    [willUnmountSheet, unmount, key, enablePanDownToClose]\n  );\n  const handleMinimize = useCallback(\n    function handleMinimize() {\n      print({\n        component: BottomSheetModal.name,\n        method: handleMinimize.name,\n        params: {\n          minimized: minimized.current,\n        },\n      });\n      if (minimized.current) {\n        return;\n      }\n      minimized.current = true;\n\n      /**\n       * if modal got minimized before it finish its mounting\n       * animation, we set the `restoreIndexRef` to the\n       * provided index.\n       */\n      if (currentIndexRef.current === -1) {\n        restoreIndexRef.current = index;\n      } else {\n        restoreIndexRef.current = currentIndexRef.current;\n      }\n      bottomSheetRef.current?.close();\n    },\n    [index]\n  );\n  const handleRestore = useCallback(function handleRestore() {\n    print({\n      component: BottomSheetModal.name,\n      method: handleRestore.name,\n      params: {\n        minimized: minimized.current,\n        forcedDismissed: forcedDismissed.current,\n      },\n    });\n    if (!minimized.current || forcedDismissed.current) {\n      return;\n    }\n    minimized.current = false;\n    bottomSheetRef.current?.snapToIndex(restoreIndexRef.current);\n  }, []);\n  //#endregion\n\n  //#region callbacks\n  const handlePortalOnUnmount = useCallback(\n    function handlePortalOnUnmount() {\n      print({\n        component: BottomSheetModal.name,\n        method: handlePortalOnUnmount.name,\n        params: {\n          minimized: minimized.current,\n          forcedDismissed: forcedDismissed.current,\n        },\n      });\n      /**\n       * if modal is already been dismiss, we exit the method.\n       */\n      if (currentIndexRef.current === -1 && minimized.current === false) {\n        return;\n      }\n\n      mounted.current = false;\n      forcedDismissed.current = true;\n\n      if (minimized.current) {\n        unmount();\n        return;\n      }\n      willUnmountSheet(key);\n      bottomSheetRef.current?.close();\n    },\n    [key, unmount, willUnmountSheet]\n  );\n  const handlePortalRender = useCallback(function handlePortalRender(\n    render: () => void\n  ) {\n    if (mounted.current) {\n      render();\n    }\n  },\n  []);\n  const handleBottomSheetOnChange = useCallback(\n    function handleBottomSheetOnChange(_index: number) {\n      print({\n        component: BottomSheetModal.name,\n        method: handleBottomSheetOnChange.name,\n        params: {\n          minimized: minimized.current,\n          forcedDismissed: forcedDismissed.current,\n        },\n      });\n      currentIndexRef.current = _index;\n\n      if (_providedOnChange) {\n        _providedOnChange(_index);\n      }\n    },\n    [_providedOnChange]\n  );\n  const handleBottomSheetOnClose = useCallback(\n    function handleBottomSheetOnClose() {\n      print({\n        component: BottomSheetModal.name,\n        method: handleBottomSheetOnClose.name,\n        params: {\n          minimized: minimized.current,\n          forcedDismissed: forcedDismissed.current,\n        },\n      });\n\n      if (minimized.current) {\n        return;\n      }\n\n      if (enableDismissOnClose) {\n        unmount();\n      }\n    },\n    [enableDismissOnClose, unmount]\n  );\n  //#endregion\n\n  //#region expose methods\n  useImperativeHandle(ref, () => ({\n    // sheet\n    snapToIndex: handleSnapToIndex,\n    snapToPosition: handleSnapToPosition,\n    expand: handleExpand,\n    collapse: handleCollapse,\n    close: handleClose,\n    forceClose: handleForceClose,\n    // modal methods\n    dismiss: handleDismiss,\n    present: handlePresent,\n    // internal\n    minimize: handleMinimize,\n    restore: handleRestore,\n  }));\n  //#endregion\n\n  // render\n  // console.log('BottomSheetModal', index, mount, data);\n  return mount ? (\n    <Portal\n      key={key}\n      name={key}\n      handleOnMount={handlePortalRender}\n      handleOnUpdate={handlePortalRender}\n      handleOnUnmount={handlePortalOnUnmount}\n    >\n      <ContainerComponent key={key}>\n        <BottomSheet\n          {...bottomSheetProps}\n          ref={bottomSheetRef}\n          key={key}\n          index={index}\n          snapPoints={snapPoints}\n          enablePanDownToClose={enablePanDownToClose}\n          animateOnMount={animateOnMount}\n          containerHeight={containerHeight}\n          containerOffset={containerOffset}\n          onChange={handleBottomSheetOnChange}\n          onClose={handleBottomSheetOnClose}\n          children={\n            typeof Content === 'function' ? <Content data={data} /> : Content\n          }\n          $modal={true}\n        />\n      </ContainerComponent>\n    </Portal>\n  ) : null;\n});\n\nconst BottomSheetModal = memo(BottomSheetModalComponent);\nBottomSheetModal.displayName = 'BottomSheetModal';\n\nexport default BottomSheetModal;\n"]}