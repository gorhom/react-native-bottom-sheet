{"version":3,"sources":["createBottomSheetScrollableComponent.tsx"],"names":["createBottomSheetScrollableComponent","type","ScrollableComponent","props","ref","focusHook","scrollEventsHandlersHook","enableFooterMarginAdjustment","overScrollMode","keyboardDismissMode","showsVerticalScrollIndicator","style","refreshing","onRefresh","progressViewOffset","refreshControl","onScroll","onScrollBeginDrag","onScrollEndDrag","onContentSizeChange","rest","nativeGestureRef","refreshControlGestureRef","scrollableRef","scrollableContentOffsetY","scrollHandler","enableContentPanningGesture","animatedFooterHeight","animatedScrollableState","animatedContentHeight","enableDynamicSizing","scrollableAnimatedProps","decelerationRate","SCROLLABLE_DECELERATION_RATE_MAPPER","value","SCROLLABLE_STATE","UNLOCKED","handleContentSizeChange","contentWidth","contentHeight","containerAnimatedStyle","marginBottom","containerStyle","current","undefined","Platform","OS","scrollableContent","GESTURE_SOURCE","SCROLLABLE","styles","container"],"mappings":"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","sourcesContent":["import React, { forwardRef, useImperativeHandle, useMemo, useRef } from 'react';\nimport { Platform } from 'react-native';\nimport { useAnimatedProps, useAnimatedStyle } from 'react-native-reanimated';\nimport { NativeViewGestureHandler } from 'react-native-gesture-handler';\nimport BottomSheetDraggableView from '../bottomSheetDraggableView';\nimport BottomSheetRefreshControl from '../bottomSheetRefreshControl';\nimport {\n  useScrollHandler,\n  useScrollableSetter,\n  useBottomSheetInternal,\n  useStableCallback,\n} from '../../hooks';\nimport {\n  GESTURE_SOURCE,\n  SCROLLABLE_DECELERATION_RATE_MAPPER,\n  SCROLLABLE_STATE,\n  SCROLLABLE_TYPE,\n} from '../../constants';\nimport { styles } from './styles';\n\nexport function createBottomSheetScrollableComponent<T, P>(\n  type: SCROLLABLE_TYPE,\n  ScrollableComponent: any\n) {\n  return forwardRef<T, P>((props, ref) => {\n    // props\n    const {\n      // hooks\n      focusHook,\n      scrollEventsHandlersHook,\n      // props\n      enableFooterMarginAdjustment = false,\n      overScrollMode = 'never',\n      keyboardDismissMode = 'interactive',\n      showsVerticalScrollIndicator = true,\n      style,\n      refreshing,\n      onRefresh,\n      progressViewOffset,\n      refreshControl,\n      // events\n      onScroll,\n      onScrollBeginDrag,\n      onScrollEndDrag,\n      onContentSizeChange,\n      ...rest\n    }: any = props;\n\n    //#region refs\n    const nativeGestureRef = useRef<NativeViewGestureHandler>(null);\n    const refreshControlGestureRef = useRef<NativeViewGestureHandler>(null);\n    //#endregion\n\n    //#region hooks\n    const { scrollableRef, scrollableContentOffsetY, scrollHandler } =\n      useScrollHandler(\n        scrollEventsHandlersHook,\n        onScroll,\n        onScrollBeginDrag,\n        onScrollEndDrag\n      );\n    const {\n      enableContentPanningGesture,\n      animatedFooterHeight,\n      animatedScrollableState,\n      animatedContentHeight,\n      enableDynamicSizing,\n    } = useBottomSheetInternal();\n    //#endregion\n\n    //#region variables\n    const scrollableAnimatedProps = useAnimatedProps(\n      () => ({\n        decelerationRate:\n          SCROLLABLE_DECELERATION_RATE_MAPPER[animatedScrollableState.value],\n        showsVerticalScrollIndicator: showsVerticalScrollIndicator\n          ? animatedScrollableState.value === SCROLLABLE_STATE.UNLOCKED\n          : showsVerticalScrollIndicator,\n      }),\n      [showsVerticalScrollIndicator]\n    );\n    //#endregion\n\n    //#region callbacks\n    const handleContentSizeChange = useStableCallback(\n      (contentWidth: number, contentHeight: number) => {\n        if (enableDynamicSizing) {\n          animatedContentHeight.value = contentHeight;\n        }\n\n        if (onContentSizeChange) {\n          onContentSizeChange(contentWidth, contentHeight);\n        }\n      }\n    );\n    //#endregion\n\n    //#region styles\n    const containerAnimatedStyle = useAnimatedStyle(\n      () => ({\n        marginBottom: enableFooterMarginAdjustment\n          ? animatedFooterHeight.value\n          : 0,\n      }),\n      [enableFooterMarginAdjustment]\n    );\n    const containerStyle = useMemo(() => {\n      return enableFooterMarginAdjustment\n        ? [\n            ...(style ? ('length' in style ? style : [style]) : []),\n            containerAnimatedStyle,\n          ]\n        : style;\n    }, [enableFooterMarginAdjustment, style, containerAnimatedStyle]);\n    //#endregion\n\n    //#region effects\n    // @ts-ignore\n    useImperativeHandle(ref, () => scrollableRef.current);\n    useScrollableSetter(\n      scrollableRef,\n      type,\n      scrollableContentOffsetY,\n      onRefresh !== undefined,\n      focusHook\n    );\n    //#endregion\n\n    //#region render\n    if (Platform.OS === 'android') {\n      const scrollableContent = (\n        <NativeViewGestureHandler\n          ref={nativeGestureRef}\n          enabled={enableContentPanningGesture}\n          shouldCancelWhenOutside={false}\n        >\n          <ScrollableComponent\n            animatedProps={scrollableAnimatedProps}\n            {...rest}\n            scrollEventThrottle={16}\n            ref={scrollableRef}\n            overScrollMode={overScrollMode}\n            keyboardDismissMode={keyboardDismissMode}\n            onScroll={scrollHandler}\n            onContentSizeChange={handleContentSizeChange}\n            style={containerStyle}\n          />\n        </NativeViewGestureHandler>\n      );\n      return (\n        <BottomSheetDraggableView\n          nativeGestureRef={nativeGestureRef}\n          refreshControlGestureRef={refreshControlGestureRef}\n          gestureType={GESTURE_SOURCE.SCROLLABLE}\n          style={styles.container}\n        >\n          {onRefresh ? (\n            <BottomSheetRefreshControl\n              ref={refreshControlGestureRef}\n              refreshing={refreshing}\n              onRefresh={onRefresh}\n              progressViewOffset={progressViewOffset}\n              style={styles.container}\n            >\n              {scrollableContent}\n            </BottomSheetRefreshControl>\n          ) : (\n            scrollableContent\n          )}\n        </BottomSheetDraggableView>\n      );\n    }\n    return (\n      <BottomSheetDraggableView\n        nativeGestureRef={nativeGestureRef}\n        gestureType={GESTURE_SOURCE.SCROLLABLE}\n        style={styles.container}\n      >\n        <NativeViewGestureHandler\n          ref={nativeGestureRef}\n          enabled={enableContentPanningGesture}\n          shouldCancelWhenOutside={false}\n        >\n          <ScrollableComponent\n            animatedProps={scrollableAnimatedProps}\n            {...rest}\n            scrollEventThrottle={16}\n            ref={scrollableRef}\n            overScrollMode={overScrollMode}\n            keyboardDismissMode={keyboardDismissMode}\n            refreshing={refreshing}\n            onRefresh={onRefresh}\n            progressViewOffset={progressViewOffset}\n            refreshControl={refreshControl}\n            onScroll={scrollHandler}\n            onContentSizeChange={handleContentSizeChange}\n            style={containerStyle}\n          />\n        </NativeViewGestureHandler>\n      </BottomSheetDraggableView>\n    );\n    //#endregion\n  });\n}\n"]}